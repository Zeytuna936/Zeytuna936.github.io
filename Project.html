<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Automated Data Visualisation for Policymaking — Final Project</title>
  <meta name="description" content="Conflict Legacy: Impact of the Yugoslav Wars on post-conflict development. Final project by Zeytuna Sultanzade." />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lora:wght@500;600&display=swap" rel="stylesheet">

  <!-- Vega -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    :root{
      /* Palette and tokens */
      --bg: #f7f9fc;
      --ink: #1f2a37;
      --muted: #4b5563;
      --brand: #264b8b;
      --accent: #59b0a5;
      --accent-warm: #e7c7a1;
      --card: #ffffff;
      --border: #e5e7eb;
      --shadow: 0 8px 24px rgba(17, 24, 39, .06);
      --radius: 16px;
      --maxw: 1120px;

      /* Motion */
      --ease: cubic-bezier(.22,.61,.36,1);
      --dur-sm: .28s;
      --dur-md: .55s;

      /* Type (fluid) */
      --h1: clamp(1.8rem, 3.5vw, 3rem);
      --h2: clamp(1.1rem, 2.2vw, 1.6rem);
      --h3: clamp(1.0rem, 1.6vw, 1.125rem);
      --lead: clamp(.98rem, 1.4vw, 1.05rem);

      /* Spacing (fluid) */
      --pad-panel: clamp(1rem, 2.2vw, 1.5rem);
      --gap: clamp(.6rem, 1.5vw, 1rem);
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html, body{ height:100%; overflow-x: hidden; scroll-behavior:smooth; }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
      color: var(--muted);
      background:
        radial-gradient(1200px 600px at 8% -10%, rgba(89,176,165,.12), transparent 60%),
        radial-gradient(1000px 500px at 110% 10%, rgba(38,75,139,.10), transparent 60%),
        var(--bg);
      line-height:1.65;
      position: relative;
    }

    /* Animated particle canvas (subtle, behind everything) */
    #bg-particles{
      position: fixed; inset: 0; z-index: -2; pointer-events: none; opacity: .28;
    }
    @media (prefers-reduced-motion: reduce){ #bg-particles{ display:none; } }

    /* Top navigation */
    .topbar{
      position: sticky; top:0; z-index:50;
      backdrop-filter: saturate(140%) blur(8px);
      background: rgba(255,255,255,.75);
      border-bottom: 1px solid var(--border);
      transition: box-shadow var(--dur-sm) var(--ease), background var(--dur-sm) var(--ease);
    }
    .topbar.scrolled{ box-shadow: 0 10px 24px rgba(17,24,39,.08); background: rgba(255,255,255,.82); }
    .topbar-inner{ max-width: var(--maxw); margin: 0 auto; display:flex; align-items:center; justify-content:space-between; padding: .75rem 1rem; }
    .brand{ display:flex; gap:.6rem; align-items:center; color: var(--brand); font-weight:600; }
    .brand-dot{ width:10px; height:10px; border-radius:50%; background: var(--accent); box-shadow:0 0 0 3px rgba(90,177,166,.2); }
    .nav{ display:flex; gap:1rem; flex-wrap:wrap; }
    .nav a{ position: relative; color: var(--ink); text-decoration:none; font-size:.95rem; padding:.35rem .5rem; border-radius:10px; }
    .nav a::after{ content:""; position:absolute; left:.5rem; right:.5rem; bottom:.2rem; height:2px; background: linear-gradient(90deg, var(--accent), var(--brand)); transform: scaleX(0); transform-origin: left; transition: transform .2s ease; }
    .nav a:hover::after{ transform: scaleX(1); }
    .nav a:focus-visible{ outline: 3px solid rgba(38,75,139,.35); outline-offset: 3px; }

    /* Header / hero */
    header{ margin: 2rem 0 1rem; }
    .hero{
      max-width: var(--maxw); margin: 0 auto; background: linear-gradient(180deg, rgba(38,75,139,.045), rgba(255,255,255,0));
      border: 1px solid var(--border); box-shadow: var(--shadow); border-radius: var(--radius);
      padding: clamp(1.2rem, 2.8vw, 2.2rem) clamp(1rem, 2.5vw, 1.5rem) clamp(1rem, 2vw, 1.6rem);
      position: relative; overflow: hidden;
    }
    .hero::before{ content:""; position:absolute; top:0; left:0; right:0; height:8px; border-top-left-radius: var(--radius); border-top-right-radius: var(--radius); background: linear-gradient(90deg, var(--accent-warm) 0%, rgba(231,199,161,.7) 30%, rgba(89,176,165,.6) 100%); background-size: 200% 100%; animation: ribbon 14s linear infinite; }
    @keyframes ribbon{ to{ background-position: 200% 0; } }

    .title{ font-family: Lora, Georgia, serif; color: var(--ink); font-size: var(--h1); letter-spacing:.2px; }
    .subtitle{ font-family: Lora, Georgia, serif; color: var(--brand); font-weight:600; font-size: var(--h2); margin-top:.35rem; }
    .tagline{ margin-top:.25rem; color: var(--muted); font-size: var(--lead); }
    .byline{ margin-top:.35rem; color:#8b1a1a; font-weight:600; }
    .links{ margin-top:.5rem; display:flex; gap:.85rem; flex-wrap:wrap; font-weight:500; }
    .links a{ color: #1d4ed8; text-decoration:none; }
    .links a:hover{ text-decoration:underline; }
    .links a:focus-visible{ outline: 3px solid rgba(38,75,139,.35); outline-offset: 2px; border-radius: 6px; }

    /* Typography guards */
    main p{ max-width: 72ch; margin-inline: auto; overflow-wrap: anywhere; word-break: normal; hyphens: auto; font-size: var(--lead); }

    /* Layout */
    .container{ max-width: var(--maxw); margin: 0 auto; padding: 0 1rem 3.5rem; display:grid; grid-template-columns: 260px 1fr; gap: 1.25rem; }
    @media (max-width: 980px){ .container{ grid-template-columns: 1fr; } }

    /* Floating ToC */
    .toc{
      position: sticky; top: 4.75rem; align-self: start; background: rgba(255,255,255,.62);
      border: 1px solid rgba(17,24,39,.06); border-left: 4px solid var(--brand); border-radius: 14px;
      box-shadow: 0 10px 30px rgba(17,24,39,.07), 0 1px 0 rgba(255,255,255,.8) inset;
      padding: 1rem .9rem 1rem 1rem; backdrop-filter: blur(10px) saturate(120%);
    }

    /* Sections / cards */
    section.panel{
      background: rgba(255,255,255,.62); border:1px solid rgba(17,24,39,.06); border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(17,24,39,.07), 0 1px 0 rgba(255,255,255,.8) inset;
      padding: var(--pad-panel); margin-bottom: 1rem; transition: transform var(--dur-sm) var(--ease), box-shadow var(--dur-sm) var(--ease), background var(--dur-sm) var(--ease);
      backdrop-filter: blur(8px) saturate(120%);
    }
    section.panel:hover{ transform: translateY(-2px); box-shadow: 0 14px 36px rgba(17,24,39,.10); }
    section.panel h2{ font-family:Lora, Georgia, serif; font-size: var(--h2); color: var(--ink); text-align:center; margin-bottom:.5rem; position: relative; }
    section.panel h2::after{ content:""; display:block; width: 64px; height: 3px; margin: .25rem auto 0; background: linear-gradient(90deg, var(--brand), var(--accent)); border-radius: 2px; opacity:.75; }
    .lead-box{ background: linear-gradient(0deg, rgba(89,176,165,.08), rgba(89,176,165,.06)); border: 1px solid var(--border); border-radius: 12px; padding: .9rem .95rem; color: #0f2f2e; margin: .5rem 0 .75rem; }

    /* Charts section */
    .chart-block{
      position: relative; border:1px solid rgba(17,24,39,.06); border-radius: 18px; padding: 1rem;
      background: rgba(255,255,255,.62); margin: .8rem auto; max-width: clamp(720px, 80vw, 980px);
      transition: box-shadow var(--dur-sm) var(--ease), transform var(--dur-sm) var(--ease), background var(--dur-sm) var(--ease);
      overflow: hidden; box-shadow: 0 10px 30px rgba(17,24,39,.07), 0 1px 0 rgba(255,255,255,.8) inset; backdrop-filter: blur(8px) saturate(120%); isolation: isolate;
    }
    .chart-block::before{ content:""; position:absolute; inset: 0; z-index:0; background:
      radial-gradient(520px 220px at 18% 12%, rgba(89,176,165,.10), transparent 60%),
      radial-gradient(440px 200px at 86% 26%, rgba(38,75,139,.08), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,1) 42%);
    }
    .chart-block > *{ position: relative; z-index: 1; }
    .chart-block:hover{ box-shadow: 0 18px 40px rgba(17,24,39,.14); transform: translateY(-2px); }
    .chart-block h3{ font-family:Lora, Georgia, serif; color:#8b1a1a; font-size: var(--h3); text-align:center; margin-bottom:.25rem; }
    .chart-notes{ margin:.25rem 0 .4rem; padding-left: 1.1rem; }
    .chart-notes li{ margin:.25rem 0; }
    figure{ margin:.5rem 0; }
    figcaption{ text-align:center; font-size:.9rem; color:#6b7280; margin-top:.2rem; }

    /* Chart container sizes */
    .viz{ width:100%; max-width: 100%; min-height:340px; position: relative; z-index: 2; }

    /* Make left/full-width chart safe on small screens */
    .chart-block--left{ max-width: 100%; margin-left: 0; margin-right: 0; }

    /* AOS-like reveal animations (opacity/transform only) */
    .reveal{ opacity: 0; transform: translateY(16px); will-change: transform, opacity; }
    .reveal.inview{ opacity: 1; transform: none; transition: opacity var(--dur-md) var(--ease), transform var(--dur-md) var(--ease); }

    /* Back to top */
    .backtop{ position: fixed; right: 1rem; bottom: 1rem; display: inline-flex; align-items:center; justify-content:center; width: 42px; height: 42px; border-radius: 999px; background: linear-gradient(180deg, var(--brand), var(--accent)); color: #fff; text-decoration:none; font-weight:600; box-shadow: 0 8px 18px rgba(38,75,139,.25); transition: transform var(--dur-sm) var(--ease), opacity .2s ease; opacity: 0; pointer-events: none; }
    .backtop.show{ opacity: 1; pointer-events: auto; }
    .backtop:hover{ transform: translateY(-2px); }

    /* Footer */
    footer{ text-align:center; color:#6b7280; padding: 2rem 1rem 3rem; }

    /* Accessibility and focus */
    a:focus-visible{ outline: 3px solid rgba(38,75,139,.35); outline-offset: 2px; border-radius: 6px; }

    /* Skip link */
    .skip{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
    .skip:focus{ position:fixed; left:1rem; top:1rem; background:#111827; color:white; padding:.5rem .75rem; border-radius:.5rem; z-index:999; }

    /* Anchor offset */
    :target{ scroll-margin-top: 6.5rem; }

    /* Mobile perf fallbacks */
    @media (max-width: 980px){
      .panel, .chart-block, .toc{ backdrop-filter: none; background: rgba(255,255,255,.92); }
      .hero::before{ animation: none; }
    }

    /* Print */
    @media print {
      #bg-particles, .topbar, .toc, .backtop { display: none !important; }
      body { background: #fff !important; }
      section.panel { box-shadow: none; border-color: #d1d5db; break-inside: avoid; }
      a::after { content: " (" attr(href) ")"; font-size: .85em; color: #6b7280; }
      .viz { min-height: 280px; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ animation: none !important; transition: none !important; }
      .reveal{ opacity: 1 !important; transform: none !important; }
      .panel, .chart-block, .toc{ backdrop-filter: none !important; }
    }
  </style>
</head>
<body>
  <canvas id="bg-particles"></canvas>
  <a href="#content" class="skip">Skip to content</a>

  <!-- Top navigation -->
  <div class="topbar" role="navigation" aria-label="Primary">
    <div class="topbar-inner">
      <div class="brand"><span class="brand-dot"></span> Policy Data Showcase</div>
      <nav class="nav">
        <a href="#aim">Aim</a>
        <a href="#charts">Charts</a>
        <a href="#limitations">Data Limitations</a>
        <a href="#conclusion">Conclusion</a>
      </nav>
    </div>
  </div>

  <!-- Header -->
  <header class="reveal">
    <div class="hero">
      <h1 class="title">Automated Data Visualisation for Policymaking</h1>
      <p class="subtitle">Final Project</p>
      <p class="tagline">Conflict Legacy: Analyzing Impact of Yugoslav Wars on Post-Conflict Development</p>
      <p class="byline">by Zeytuna Sultanzade</p>
      <p class="links" aria-label="Profile links">
        <a href="https://uk.linkedin.com/in/zeytuna-sultanzade-075abb20b/" target="_blank" rel="noopener">LinkedIn</a> ·
        <a href="https://github.com/Zeytuna936" target="_blank" rel="noopener">GitHub</a> ·
        <a href="https://zeytuna936.github.io" target="_blank" rel="noopener">Portfolio</a>
      </p>
    </div>
  </header>

  <!-- Main layout -->
  <div class="container">
    <!-- ToC -->
    <aside class="toc reveal" role="navigation" aria-label="Contents">
      <h3>Contents</h3>
      <ul>
        <li><a href="#aim" data-spy> Aim of the Project</a></li>
        <li><a href="#charts" data-spy> Data Collection & Charts</a></li>
        <li><a href="#limitations" data-spy> Data Limitations</a></li>
        <li><a href="#conclusion" data-spy> Conclusion</a></li>
      </ul>
    </aside>

    <!-- Content -->
    <main id="content">
      <!-- Aim -->
      <section id="aim" class="panel reveal">
        <h2>Aim of the Project</h2>
        <p>
          Armed conflicts are among the primary barriers to sustainable development, undermining progress through weakened governance, which leads to institutional inefficiency, corruption, and political instability, as well as through severe economic disruption. These effects include rising unemployment and inflation, damaged supply chains, declining investment, and capital flight. As a result, citizens either continue their lives under difficult conditions or migrate abroad, leading to the displacement of skilled labor and an increase in global migration.
        </p>
        <div class="lead-box">
          Being known as the deadliest one in Europe since WW2, the
          <a href="https://www.icty.org/en/about/what-former-yugoslavia/conflicts" target="_blank" rel="noopener">Yugoslav Wars</a>
          caused large-scale human suffering, including ethnic cleansing, genocide, and psychological trauma, and ultimately led to the disintegration of Yugoslavia. Among the six successor states, Bosnia and Herzegovina, Croatia, and Serbia were most severely affected, while others, such as Montenegro, North Macedonia, and Slovenia, achieved independence through relatively peaceful means.
        </div>
        <p>
          This research aims to examine the extent to which the Yugoslav Wars hindered the development of the former Yugoslav republics, with a particular focus on those most directly impacted. The project will assess and compare key indicators of development, including economic performance, institutional quality, and social progress, to evaluate the long-term developmental consequences of the conflict across these nations.
        </p>
      </section>

      <!-- Charts -->
      <section id="charts" class="panel reveal">
        <h2>Data Collection and Charts</h2>

        <!-- Chart 1 (centered) -->
        <article class="chart-block reveal" aria-labelledby="c1h">
          <h3 id="c1h">Chart1/Main Highlights:</h3>
          <ul class="chart-notes">
            <li>The GDP of Croatia, Slovenia, and Serbia is significantly higher than the others;</li>
            <li>Since 2000, these countries have never experienced a dramatic decrease in GDP;</li>
            <li>From the data of GDP of all countries available on <a href="https://databank.worldbank.org/reports.aspx?source=2&series=NY.GDP.MKTP.CD&country" target="_blank" rel="noopener">WorldBank,</a> only data for 6 target countries were scraped via on <a href="https://colab.research.google.com/drive/1lmhYzx_wYRgelaBbZK7f6-znE2jOH0ml?usp=sharing" target="_blank" rel="noopener">Colab</a></li>
          </ul>
          <figure>
            <div id="Location1" class="viz" role="img" aria-label="Vega chart: GDP over time"></div>
            <figcaption>GDP trends among former Yugoslav countries.</figcaption>
          </figure>
        </article>

        <!-- Chart 2 (centered) -->
        <article class="chart-block reveal" aria-labelledby="c2h">
          <h3 id="c2h">Chart2/Main Highlights:</h3>
          <ul class="chart-notes">
            <li>Considering the GDPs of all countries, Slovenia spends the highest amount of money on RD;</li>
            <li>The original data from <a href="https://databank.worldbank.org/source/world-development-indicators/Series/GB.XPD.RSDV.GD.ZS" target="_blank" rel="noopener">WorldBank,</a>  were scraped via <a href="https://colab.research.google.com/drive/1jSRloD9aSeebTqMVwVwef_mmbgFb8QqM?usp=sharing" target="_blank" rel="noopener">Colab</a></li>
          </ul>
          <figure>
            <div id="Location2" class="viz" role="img" aria-label="Vega chart: R and D expenditure"></div>
            <figcaption>R&amp;D intensity among countries.</figcaption>
          </figure>
        </article>

        <!-- Chart 3 (centered) -->
        <article class="chart-block reveal" aria-labelledby="c3h">
          <h3 id="c3h">Chart3/Main Highlights:</h3>
          <ul class="chart-notes">
            <li>The bar chart compares economic indicators among 6 countries from 2007 to 2023;</li>
            <li>A CSV file where only 6 countries and their indicators are shown was created;</li>
            <li>Additional interactivity of filtering data was added by using “params” and “transform” functions</li>
          </ul>
          <figure>
            <div id="Location3" class="viz" role="img" aria-label="Vega chart: comparative indicators"></div>
            <figcaption>Interactive comparison of key indicators.</figcaption>
          </figure>
        </article>

        <!-- Chart 4 (NOT centered; left/full width) -->
        <article class="chart-block chart-block--left reveal" aria-labelledby="c4h">
          <h3 id="c4h">Chart4/Main Highlights:</h3>
          <ul class="chart-notes">
            <li>Slovenia has the highest life expectancy rate, followed by Croatia; </li>
            <li>Around 10% of GDP of these countries is spent on health expenditure;</li>
            <li>The data for the heatmap was obtained from <a href="https://databank.worldbank.org/source/health-nutrition-and-population-statistics" target="_blank" rel="noopener">WorldBank.</a> The Colab network, where targeted indicators and countries were scraped is available <a href="https://colab.research.google.com/drive/1lLus3hKo_wbXCNcuB1Px7Ok9wAVVXZeG?usp=sharing" target="_blank" rel="noopener">here</a></li>
          </ul>
          <figure>
            <div id="Location4" class="viz" role="img" aria-label="Vega chart: health and life expectancy"></div>
            <figcaption>Heatmap of health indicators.</figcaption>
          </figure>
        </article>

        <!-- Chart 5 (centered) -->
        <article class="chart-block reveal" aria-labelledby="c5h">
          <h3 id="c5h">Chart5/Main Highlights:</h3>
          <ul class="chart-notes">
            <li>Serbia releases the largest amount of CO2 among the others, which can be related to its high dependence on fossil fuels and the industrial sector;</li>
            <li>The data for all countries and indicators was accessed from <a href="https://databank.worldbank.org/source/millennium-development-goals/Series/EN.ATM.CO2E.KT" target="_blank" rel="noopener"> WorldBank </a> and scraped on <a href="https://colab.research.google.com/drive/1mvJcDevIoGRIEotViWpiCvdbfvjqLbFx?usp=sharing" target="_blank" rel="noopener"> Colab</a></li>
          </ul>
          <figure>
            <div id="Location5" class="viz" role="img" aria-label="Vega chart: CO2 emissions"></div>
            <figcaption>CO₂ emissions across countries.</figcaption>
          </figure>
        </article>

        <!-- Chart 6 (centered) -->
        <article class="chart-block reveal" aria-labelledby="c6h">
          <h3 id="c6h">Chart6/Main Highlights:</h3>
          <ul class="chart-notes">
            <li>BH and Serbia have the highest level of corruption and the lowest level of freedom index and rule of law, while Slovenia has the best indicators for state capacity;</li>
            <li>A CSV file where statistics of on only targeted countries are shown was created</li>
          </ul>
          <figure>
            <div id="Location6" class="viz" role="img" aria-label="Vega chart: governance & state capacity"></div>
            <figcaption>Bubble chart of governance indicators.</figcaption>
          </figure>
        </article>
      </section>

      <!-- Data Limitations -->
      <section id="limitations" class="panel reveal">
        <h2>Data Limitations</h2>
        <p>
          The availability of data across the six countries is uneven, particularly for Bosnia and Herzegovina (BH), North Macedonia (NM), and Montenegro. This limitation is most visible in the emissions dataset presented in Chart 5. Historical country-level information before the breakup of Yugoslavia is also scarce; for instance, the 1990 data points could not be included in Chart 2 due to gaps in the available series.
        </p>
        <p>
          For Charts 3 and 6, fully comparable indicators for all countries were not accessible from official or high-reliability sources. As a result, supplementary data from Wikipedia were used to close missing gaps. Since the source contained multiple tables with inconsistent labels and unmarked sections, the initial Python extraction produced mixed results. To ensure accuracy and comparability, the datasets were manually reviewed and standardized in Excel before visualization.
        </p>
      </section>

      <!-- Conclusion -->
      <section id="conclusion" class="panel reveal">
        <h2>Conclusion</h2>
        <p>
          Slovenia and Croatia demonstrate stronger development outcomes compared to the other countries in the region. Although Serbia records the second-highest GDP, it continues to face a relatively high unemployment rate when compared with Croatia and Slovenia. Bosnia and Herzegovina remains the most constrained, reflecting the extent of wartime damage, political fragmentation, and institutional challenges. The results for North Macedonia, which is landlocked, and Montenegro, which relies heavily on tourism, are consistent with their structural characteristics.
        </p>
        <p>
          While it is difficult to establish a direct causal link between current performance and the legacy of conflict, the long-term effects appear most visible in Bosnia and Herzegovina. Serbia, with its stronger institutional base and strategic ties to eastern partners, and Croatia, with closer alignment to the European Union and a robust tourism sector, have both made greater progress in overcoming post-conflict barriers.
        </p>
      </section>
    </main>
  </div>

  <a href="#top" class="backtop" aria-label="Back to top" title="Back to top">↑</a>

  <footer class="reveal">
    © <span id="year"></span> Zeytuna Sultanzade • Built with Vega-Lite
  </footer>

  <!-- Vega Theme + Embeds -->
  <script>
    const vegaTheme = {
      config: {
        background: "#fcfdff",
        font: "Inter, system-ui, -apple-system, Segoe UI, Arial, sans-serif",
        axis: { labelColor: "#1f2a37", titleColor: "#1f2a37", gridColor: "#e5e7eb", tickColor: "#cbd5e1" },
        header: { labelColor: "#1f2a37", titleColor: "#1f2a37" },
        legend: { labelColor: "#374151", titleColor: "#1f2a37" },
        title: { color: "#1f2a37", font: "Lora, Georgia, serif", fontWeight: 600 },
        view: { stroke: "#e5e7eb" },
        range: { category: ["#264b8b", "#59b0a5", "#6b8bb7", "#94a3b8", "#2a9d8f", "#3f37c9"] }
      }
    };
    const opts = { actions: false, theme: vegaTheme };

    vegaEmbed('#Location1', 'ProjectGDP.json', opts);
    vegaEmbed('#Location2', 'ProjectRD.json', opts);
    vegaEmbed('#Location3', 'ProjectBarChart.json', opts);
    vegaEmbed('#Location4', 'ProjectHealth.json', opts);
    vegaEmbed('#Location5', 'ProjectCO2.json', opts);
    vegaEmbed('#Location6', 'ProjectBubble.json', opts);
  </script>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // TOC spy
    const spyLinks = Array.from(document.querySelectorAll('[data-spy]'));
    const sections = spyLinks.map(a => document.querySelector(a.getAttribute('href'))).filter(Boolean);
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const id = '#' + entry.target.id;
        const link = spyLinks.find(a => a.getAttribute('href') === id);
        if (link){ if (entry.isIntersecting) { spyLinks.forEach(a => a.removeAttribute('aria-current')); link.setAttribute('aria-current','true'); } }
      });
    }, { rootMargin: '-50% 0px -40% 0px', threshold: 0 });
    sections.forEach(sec => observer.observe(sec));

    // Scroll toggles
    const backTop = document.querySelector('.backtop');
    const topbar = document.querySelector('.topbar');
    const toggleOnScroll = () => {
      const y = window.scrollY || window.pageYOffset;
      if (y > 600) backTop.classList.add('show'); else backTop.classList.remove('show');
      if (y > 8) topbar.classList.add('scrolled'); else topbar.classList.remove('scrolled');
    };
    window.addEventListener('scroll', toggleOnScroll, { passive: true });
    toggleOnScroll();
  </script>

  <script>
    // Background particles with throttling + pause on chart interaction
    (function(){
      const canvas = document.getElementById('bg-particles');
      if (!canvas) return;
      const ctx = canvas.getContext('2d', { alpha: true });
      let width, height, particles, rafId, running = true, skip = 0;
      const DPR = Math.min(window.devicePixelRatio || 1, 2);
      const MOBILE = () => window.matchMedia('(max-width: 980px)').matches;
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const BASE_COUNT = 60;                // desktop
      const MOBILE_COUNT = 34;              // mobile cap
      const SPEED = 0.08;                   // slow drift
      const LINKS_DIST = 140;               // link distance in px
      const COLORS = ['#264b8b', '#59b0a5', '#e7c7a1'];

      if (prefersReduced) return; // accessibility

      function resize(){
        width = canvas.clientWidth = window.innerWidth;
        height = canvas.clientHeight = window.innerHeight;
        canvas.width = Math.floor(width * DPR);
        canvas.height = Math.floor(height * DPR);
        ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
        createParticles();
      }

      function rand(min, max){ return Math.random() * (max - min) + min; }

      function createParticles(){
        const COUNT = MOBILE() ? MOBILE_COUNT : BASE_COUNT;
        particles = new Array(COUNT).fill(0).map(() => ({
          x: rand(0, width), y: rand(0, height), vx: rand(-SPEED, SPEED), vy: rand(-SPEED, SPEED), r: rand(1.2, 2.2), c: COLORS[(Math.random() * COLORS.length) | 0]
        }));
      }

      function draw(){
        ctx.clearRect(0,0,width,height);
        // points
        for (let i=0;i<particles.length;i++){
          const p = particles[i]; p.x += p.vx; p.y += p.vy;
          if (p.x < -20) p.x = width + 20; else if (p.x > width + 20) p.x = -20;
          if (p.y < -20) p.y = height + 20; else if (p.y > height + 20) p.y = -20;
          ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fillStyle = p.c; ctx.globalAlpha = 0.23; ctx.fill();
        }
        // lines
        ctx.globalAlpha = 0.1; ctx.lineWidth = 1;
        for (let i=0;i<particles.length;i++){
          for (let j=i+1;j<particles.length;j++){
            const p = particles[i], q = particles[j]; const dx = p.x - q.x, dy = p.y - q.y; const d2 = dx*dx + dy*dy;
            if (d2 < LINKS_DIST*LINKS_DIST){ ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(q.x, q.y); const grad = ctx.createLinearGradient(p.x, p.y, q.x, q.y); grad.addColorStop(0, p.c); grad.addColorStop(1, q.c); ctx.strokeStyle = grad; ctx.stroke(); }
          }
        }
        ctx.globalAlpha = 1;
      }

      // frame step with throttling (30fps baseline, 15fps when interacting)
      let throttle = 2; // render every 2nd rAF (~30fps on 60Hz)
      function step(){
        if (!running) return;
        skip = (skip + 1) % throttle; // skip frames
        if (skip === 0) draw();
        rafId = requestAnimationFrame(step);
      }

      function start(){ running = true; cancelAnimationFrame(rafId); resize(); step(); }
      function stop(){ running = false; cancelAnimationFrame(rafId); }

      // Pause when tab hidden
      document.addEventListener('visibilitychange', ()=>{ if (document.hidden) stop(); else start(); });

      // Pause/throttle when charts are hovered or in view
      const vizEls = Array.from(document.querySelectorAll('.viz'));
      function pauseBG(){ throttle = 4; }   // ~15fps
      function resumeBG(){ throttle = 2; }  // ~30fps
      vizEls.forEach(el=>{
        el.addEventListener('mouseenter', pauseBG);
        el.addEventListener('mouseleave', resumeBG);
        el.addEventListener('pointerdown', pauseBG);
        el.addEventListener('pointerup', resumeBG);
      });

      // If any chart is in viewport, keep throttled; otherwise normal
      const io = new IntersectionObserver((entries)=>{
        const anyInView = entries.some(e=> e.isIntersecting);
        throttle = anyInView ? 3 : 2; // ~20fps when charts on screen
      }, { threshold: 0.1 });
      vizEls.forEach(el=> io.observe(el));

      window.addEventListener('resize', resize, { passive: true });
      start();
    })();
  </script>

  <script>
    // Minimal AOS-like reveal: observe .reveal and toggle .inview (no heavy libs)
    (function(){
      const els = document.querySelectorAll('.reveal');
      if (!('IntersectionObserver' in window) || !els.length) return els.forEach(el => el.classList.add('inview'));
      const io = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('inview'); io.unobserve(e.target); } }); }, { rootMargin: '0px 0px -10% 0px', threshold: 0.1 });
      els.forEach(el=>io.observe(el));
    })();
  </script>
</body>
</html>
